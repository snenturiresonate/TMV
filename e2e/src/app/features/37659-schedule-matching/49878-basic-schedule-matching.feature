Feature: 37659 - Basic Schedule matching framework
  As a TMV user
  I want C-class data on running services to be matched to the planned train schedule from the CIF
  So that I can system can build and update a train models to allow schematic maps to display trains and their timetables

  @tdd
  Scenario: 37659 -1  Display when no matching schedule (berth, location or subdivision)
    # Given a TD update with the type <Step Type> has been received
    # And the berth included doesn't match a schedule at berth, location or sub division
    # When the user views the map containing that berth
    # Then train description is displayed in the berth in a coloured box (no timetable from admin for unmatched)
    # Examples:
    #  | Step Type |
    #  | Interpose |
    #  | Step |
    Given the train in CIF file below is updated accordingly so time at the reference point is now, and then received from LINX
      | filePath                         | refLocation | refTimingType | newTrainDescription | newPlanningUid |
      | access-plan/1D46_PADTON_OXFD.cif | PADTON      | WTT_dep       | 0A01                | M00001         |
    And the following live berth interpose message is sent from LINX (which won't match anything)
        | toBerth | trainDescriber | trainDescription |
        | R001    | 0A01           | D3               |
    When I am viewing the map hdgw01paddington.v
    Then berth 'R001' in train describer 'D3' contains '0A01' and is visible
    And the train headcode color for berth 'D3R001' is blue

  @tdd
  Scenario: 37659 -2 Context menu when no matching schedule (berth, location or subdivision)
    # Given a TD update with the type <Step Type> has been received
    # And the berth included doesn't match a schedule at berth, location or sub division
    # And the user is viewing the map that contains that berth
    # When the user opens the context menu for the train description
    # Then the unmatched version of the context menu is displayed
    # Examples:
    #  | Step Type |
    #  | Interpose |
    #  | Step |
    Given the following berth step message is sent from LINX
      | fromBerth  | timestamp  | toBerth   | trainDescriber   | trainDescription  |
      | 0246       | 10:02:06   | 9X99      | 0A01             | D3                |
    And I am viewing the map hdgw01paddington.v
    Then berth 'R001' in train describer 'D3' contains '0A01' and is visible
    When I invoke the context menu on the map for train '0A01'
    And the map context menu contains 'Unmatch' on line 3

  @tdd
  Scenario Outline: 37659 -3a Display when single matching schedule / 37659 - 4a Context menu when single matching schedule - Step Type - Interpose
    # Given a TD update with the type <Step Type> has been received
    # And the berth included  matches a single schedule at <match level>
    # When the user views the map containing that berth
    # Then train description is displayed in the berth and colour reflects punctuality (not no timetable colour)

    # Given a TD update with the type <Step Type> has been received
    # And the berth included  matches a single schedule at <match level>
    # And the user is viewing the map that contains that berth
    # When the user opens the context menu for the train description
    # Then the matched version of the context menu is displayed
    # Examples:
      # | Step Type |
      # | Interpose |
      # | Step |

      # | Match level |
      # | berth |
      # | location |
      # | sub division |
    Given the following VSTP messages are sent from LINX
      | asXml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      | <vstpXML> |
    And the following live berth interpose message is sent from LINX (creating a match)
      | toBerth      | trainDescriber   | trainDescription  |
      | <toBerth>    | <trainDescriber> | <trainDescription>|
    When I am viewing the map <map>
    And berth '<toBerth>' in train describer '<trainDescriber>' contains '<trainDescription>'
    And the train headcode color for berth '<trainDescriber><toBerth>' is green
    When I invoke the context menu on the map for train '<trainDescription>'
    And the map context menu contains 'Match' on line 3
    And I open timetable from the map context menu
    And I switch to the new tab
    Then The values for the header properties are as follows
      | schedType | lastSignal | lastReport | trainUid   | trustId | lastTJM    | headCode          |
      | LTP       |            |            | <trainUid> |         |          | <trainDescription>  |
    Examples:
      | map                 | toBerth | trainDescriber | trainDescription |trainUid |vstpXML  |
      | hdgw01paddington.v  | 3061    | D3             | 1A55             |R12345   |<VSTPCIFMsgV1 xmlns="http://xml.networkrail.co.uk/ns/2008/Train" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:eai="http://xml.networkrail.co.uk/ns/2008/EAI" classification="industry" timestamp="2020-02-24T00:47:08-00:00" owner="Network Rail"	originMsgId="2020-02-24T00:47:10-00:00@vstp.networkrail.co.uk">	<eai:Sender organisation="Network Rail" application="TSIA" component="TSIA" userID="#WAEDMRT" sessionID="X289735" /><schedule schedule_id="" transaction_type="Create"	schedule_start_date="20210118" schedule_end_date="20500101"	schedule_days_runs="1111111" applicable_timetable="N" CIF_bank_holiday_running="" CIF_train_uid="R12345" train_status="2" CIF_stp_indicator="O"><schedule_segment signalling_id="1A55" uic_code="" atoc_code="" CIF_train_category="H4" CIF_headcode="6Y01" CIF_course_indicator="" CIF_train_service_code="57610310" CIF_business_sector="" CIF_power_type="D" CIF_timing_load="1660"	CIF_speed="125" CIF_operating_characteristics="AB" CIF_train_class="B" CIF_sleepers="F" CIF_reservations="A" CIF_connection_indicator="" CIF_catering_code="FC" CIF_service_branding="" CIF_traction_class=""><schedule_location scheduled_arrival_time=" " scheduled_departure_time="001101" scheduled_pass_time=" " public_arrival_time=" " public_departure_time="001201"	CIF_platform="1" CIF_line="ML" CIF_path="OL" CIF_activity="TB"	CIF_engineering_allowance="1" CIF_pathing_allowance="2"	CIF_performance_allowance="3"><location><tiploc tiploc_id="PTALBOT" /></location></schedule_location><schedule_location scheduled_arrival_time="011301"	scheduled_departure_time="      " scheduled_pass_time="      "  public_arrival_time="011401" public_departure_time="  "  CIF_platform="1" CIF_line="" CIF_path="OL" CIF_activity="TF"  CIF_engineering_allowance="4" CIF_pathing_allowance="5" CIF_performance_allowance="6"><location><tiploc tiploc_id="BGLAN" /></location></schedule_location></schedule_segment></schedule></VSTPCIFMsgV1> |
      | hdgw01paddington.v  | 0914    | D3             | 6Y01             |Q12345   |<VSTPCIFMsgV1 xmlns="http://xml.networkrail.co.uk/ns/2008/Train"	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:eai="http://xml.networkrail.co.uk/ns/2008/EAI" classification="industry" timestamp="2020-02-24T00:47:08-00:00" owner="Network Rail"	originMsgId="2020-02-24T00:47:10-00:00@vstp.networkrail.co.uk">	<eai:Sender organisation="Network Rail" application="TSIA"	component="TSIA" userID="#WAEDMRT" sessionID="X289735" /><schedule schedule_id="" transaction_type="Create"	schedule_start_date="20210118" schedule_end_date="20500101"	schedule_days_runs="1111111" applicable_timetable="N" CIF_bank_holiday_running="" CIF_train_uid="D12345" train_status="2" CIF_stp_indicator="O">		<schedule_segment signalling_id="6Y01" uic_code="" atoc_code="" CIF_train_category="H4" CIF_headcode="6Y01"	CIF_course_indicator="" CIF_train_service_code="57610310" CIF_business_sector="" CIF_power_type="D" CIF_timing_load="1660" CIF_speed="125" CIF_operating_characteristics="AB" CIF_train_class="B" CIF_sleepers="F" CIF_reservations="A" CIF_connection_indicator=""	CIF_catering_code="FC" CIF_service_branding="" CIF_traction_class=""><schedule_location scheduled_arrival_time=" " scheduled_departure_time="001101" scheduled_pass_time=" " public_arrival_time=" " public_departure_time="001201" CIF_platform="1" CIF_line="ML" CIF_path="OL" CIF_activity="TB"	CIF_engineering_allowance="1" CIF_pathing_allowance="2"	CIF_performance_allowance="3"><location><tiploc tiploc_id="DRBY" /></location></schedule_location><schedule_location scheduled_arrival_time="011301" scheduled_departure_time="      " scheduled_pass_time="      " public_arrival_time="011401" public_departure_time=" " CIF_platform="1" CIF_line="" CIF_path="OL" CIF_activity="TF" CIF_engineering_allowance="4" CIF_pathing_allowance="5" CIF_performance_allowance="6"><location><tiploctiploc_id="DIDCOTP"/></location></schedule_location></schedule_segment></schedule></VSTPCIFMsgV1>      |
      | hdgw01paddington.v  | 1255    | D3             | 8Y01             |D12345   |<VSTPCIFMsgV1	xmlns="http://xml.networkrail.co.uk/ns/2008/Train"	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"	xmlns:eai="http://xml.networkrail.co.uk/ns/2008/EAI" classification="industry" timestamp="2020-02-24T00:47:08-00:00" owner="Network Rail"	originMsgId="2020-02-24T00:47:10-00:00@vstp.networkrail.co.uk"><eai:Sender organisation="Network Rail" application="TSIA" component="TSIA" userID="#WAEDMRT" sessionID="X289735" /><schedule schedule_id="" transaction_type="Create" schedule_start_date="20210118" schedule_end_date="20500101"		schedule_days_runs="1111111" applicable_timetable="N" CIF_bank_holiday_running="" CIF_train_uid="Q12345" train_status="2" CIF_stp_indicator="O">		<schedule_segment signalling_id="8Y01" uic_code="" atoc_code="" CIF_train_category="H4" CIF_headcode="8Y01"	CIF_course_indicator="" CIF_train_service_code="57610310" CIF_business_sector="" CIF_power_type="D" CIF_timing_load="1660" CIF_speed="125" CIF_operating_characteristics="AB" CIF_train_class="B" CIF_sleepers="F" CIF_reservations="A" CIF_connection_indicator=""	CIF_catering_code="FC" CIF_service_branding="" CIF_traction_class="">	<schedule_location scheduled_arrival_time=" " scheduled_departure_time="001101" scheduled_pass_time=" " public_arrival_time=" " public_departure_time="001201"CIF_platform="1" CIF_line="ML" CIF_path="OL" CIF_activity="TB" CIF_engineering_allowance="1" CIF_pathing_allowance="2" CIF_performance_allowance="3"><location><tiploc tiploc_id="DRBY" /></location></schedule_location><schedule_location scheduled_arrival_time="011301" scheduled_departure_time="      " scheduled_pass_time="      " public_arrival_time="011401" public_departure_time="      "	CIF_platform="1" CIF_line="" CIF_path="OL" CIF_activity="TF" CIF_engineering_allowance="4" CIF_pathing_allowance="5"	CIF_performance_allowance="6"><location><tiploc tiploc_id="EUSKJNY" /></location></schedule_location></schedule_segment></schedule></VSTPCIFMsgV1> |

  @tdd
  Scenario Outline: 37659 -3b Display when single matching schedule  / 37659 - 4b Context menu when single matching schedule - Step Type - Step
    # Given a TD update with the type <Step Type> has been received
    # And the berth included  matches a single schedule at <match level>
    # When the user views the map containing that berth
    # Then train description is displayed in the berth and colour reflects punctuality (not no timetable colour)

    # Given a TD update with the type <Step Type> has been received
    # And the berth included  matches a single schedule at <match level>
    # And the user is viewing the map that contains that berth
    # When the user opens the context menu for the train description
    # Then the matched version of the context menu is displayed
    # Examples:
      # | Step Type |
      # | Interpose |
      # | Step |

      # | Match level |
      # | berth |
      # | location |
    Given the following VSTP messages are sent from LINX
      | asXml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      | <vstpXML> |
    And the following berth step message is sent from LINX
      | fromBerth  | timestamp  | toBerth   | trainDescriber   | trainDescription  |
      | <fromBerth>| <timestamp>| <toBerth> | <trainDescriber> | <trainDescription>|
    When I am viewing the map <map>
    And berth '<toBerth>' in train describer '<trainDescription>' contains '<trainDescriber>'
    And the train headcode color for berth '<trainDescriber><toBerth>' is green
    When I invoke the context menu on the map for train '<trainDescription>'
    Then the map context menu contains 'Match' on line 3
    And I open timetable from the map context menu
    And I switch to the new tab
    Then The values for the header properties are as follows
      | schedType | lastSignal | lastReport | trainUid   | trustId | lastTJM    | headCode          |
      | LTP       |            |            | <trainUid> |         |          | <trainDescription>  |
    Examples:
      | map                 | fromBerth |toBerth | trainDescriber | trainDescription |trainUid |timestamp |vstpXML  |
      | hdgw01paddington.v  |  1513     |3061    | D3             | 1A55             |R12345   | 10:02:06 |<VSTPCIFMsgV1 xmlns="http://xml.networkrail.co.uk/ns/2008/Train" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:eai="http://xml.networkrail.co.uk/ns/2008/EAI" classification="industry" timestamp="2020-02-24T00:47:08-00:00" owner="Network Rail"	originMsgId="2020-02-24T00:47:10-00:00@vstp.networkrail.co.uk">	<eai:Sender organisation="Network Rail" application="TSIA" component="TSIA" userID="#WAEDMRT" sessionID="X289735" /><schedule schedule_id="" transaction_type="Create"	schedule_start_date="20210118" schedule_end_date="20500101"	schedule_days_runs="1111111" applicable_timetable="N" CIF_bank_holiday_running="" CIF_train_uid="R12345" train_status="2" CIF_stp_indicator="O"><schedule_segment signalling_id="1A55" uic_code="" atoc_code="" CIF_train_category="H4" CIF_headcode="6Y01" CIF_course_indicator="" CIF_train_service_code="57610310" CIF_business_sector="" CIF_power_type="D" CIF_timing_load="1660"	CIF_speed="125" CIF_operating_characteristics="AB" CIF_train_class="B" CIF_sleepers="F" CIF_reservations="A" CIF_connection_indicator="" CIF_catering_code="FC" CIF_service_branding="" CIF_traction_class=""><schedule_location scheduled_arrival_time=" " scheduled_departure_time="001101" scheduled_pass_time=" " public_arrival_time=" " public_departure_time="001201"	CIF_platform="1" CIF_line="ML" CIF_path="OL" CIF_activity="TB"	CIF_engineering_allowance="1" CIF_pathing_allowance="2"	CIF_performance_allowance="3"><location><tiploc tiploc_id="PTALBOT" /></location></schedule_location><schedule_location scheduled_arrival_time="011301"	scheduled_departure_time="      " scheduled_pass_time="      "  public_arrival_time="011401" public_departure_time="  "  CIF_platform="1" CIF_line="" CIF_path="OL" CIF_activity="TF"  CIF_engineering_allowance="4" CIF_pathing_allowance="5" CIF_performance_allowance="6"><location><tiploc tiploc_id="BGLAN" /></location></schedule_location></schedule_segment></schedule></VSTPCIFMsgV1> |
      | hdgw01paddington.v  |  3345     |0914    | D3             | 6Y01             |Q12345   | 10:02:06 |<VSTPCIFMsgV1 xmlns="http://xml.networkrail.co.uk/ns/2008/Train"	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:eai="http://xml.networkrail.co.uk/ns/2008/EAI" classification="industry" timestamp="2020-02-24T00:47:08-00:00" owner="Network Rail"	originMsgId="2020-02-24T00:47:10-00:00@vstp.networkrail.co.uk">	<eai:Sender organisation="Network Rail" application="TSIA"	component="TSIA" userID="#WAEDMRT" sessionID="X289735" /><schedule schedule_id="" transaction_type="Create"	schedule_start_date="20210118" schedule_end_date="20500101"	schedule_days_runs="1111111" applicable_timetable="N" CIF_bank_holiday_running="" CIF_train_uid="D12345" train_status="2" CIF_stp_indicator="O">		<schedule_segment signalling_id="6Y01" uic_code="" atoc_code="" CIF_train_category="H4" CIF_headcode="6Y01"	CIF_course_indicator="" CIF_train_service_code="57610310" CIF_business_sector="" CIF_power_type="D" CIF_timing_load="1660" CIF_speed="125" CIF_operating_characteristics="AB" CIF_train_class="B" CIF_sleepers="F" CIF_reservations="A" CIF_connection_indicator=""	CIF_catering_code="FC" CIF_service_branding="" CIF_traction_class=""><schedule_location scheduled_arrival_time=" " scheduled_departure_time="001101" scheduled_pass_time=" " public_arrival_time=" " public_departure_time="001201" CIF_platform="1" CIF_line="ML" CIF_path="OL" CIF_activity="TB"	CIF_engineering_allowance="1" CIF_pathing_allowance="2"	CIF_performance_allowance="3"><location><tiploc tiploc_id="DRBY" /></location></schedule_location><schedule_location scheduled_arrival_time="011301" scheduled_departure_time="      " scheduled_pass_time="      " public_arrival_time="011401" public_departure_time=" " CIF_platform="1" CIF_line="" CIF_path="OL" CIF_activity="TF" CIF_engineering_allowance="4" CIF_pathing_allowance="5" CIF_performance_allowance="6"><location><tiploctiploc_id="DIDCOTP"/></location></schedule_location></schedule_segment></schedule></VSTPCIFMsgV1>      |
      | hdgw01paddington.v  |  1815     |1255    | D3             | 8Y01             |D12345   | 10:02:06 |<VSTPCIFMsgV1	xmlns="http://xml.networkrail.co.uk/ns/2008/Train"	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"	xmlns:eai="http://xml.networkrail.co.uk/ns/2008/EAI" classification="industry" timestamp="2020-02-24T00:47:08-00:00" owner="Network Rail"	originMsgId="2020-02-24T00:47:10-00:00@vstp.networkrail.co.uk"><eai:Sender organisation="Network Rail" application="TSIA" component="TSIA" userID="#WAEDMRT" sessionID="X289735" /><schedule schedule_id="" transaction_type="Create" schedule_start_date="20210118" schedule_end_date="20500101"		schedule_days_runs="1111111" applicable_timetable="N" CIF_bank_holiday_running="" CIF_train_uid="Q12345" train_status="2" CIF_stp_indicator="O">		<schedule_segment signalling_id="8Y01" uic_code="" atoc_code="" CIF_train_category="H4" CIF_headcode="8Y01"	CIF_course_indicator="" CIF_train_service_code="57610310" CIF_business_sector="" CIF_power_type="D" CIF_timing_load="1660" CIF_speed="125" CIF_operating_characteristics="AB" CIF_train_class="B" CIF_sleepers="F" CIF_reservations="A" CIF_connection_indicator=""	CIF_catering_code="FC" CIF_service_branding="" CIF_traction_class="">	<schedule_location scheduled_arrival_time=" " scheduled_departure_time="001101" scheduled_pass_time=" " public_arrival_time=" " public_departure_time="001201"CIF_platform="1" CIF_line="ML" CIF_path="OL" CIF_activity="TB" CIF_engineering_allowance="1" CIF_pathing_allowance="2" CIF_performance_allowance="3"><location><tiploc tiploc_id="DRBY" /></location></schedule_location><schedule_location scheduled_arrival_time="011301" scheduled_departure_time="      " scheduled_pass_time="      " public_arrival_time="011401" public_departure_time="      "	CIF_platform="1" CIF_line="" CIF_path="OL" CIF_activity="TF" CIF_engineering_allowance="4" CIF_pathing_allowance="5"	CIF_performance_allowance="6"><location><tiploc tiploc_id="EUSKJNY" /></location></schedule_location></schedule_segment></schedule></VSTPCIFMsgV1> |

  @tdd
  Scenario: 37659 -5 Display when consistent stepping /  37659 -5  Context menu when consistent stepping

    # Given a TD update with the type <Step Type> has been received
    # And a prior TD update has been matched to the service in the last 20 mins (configurable value)
    # When the user views the map containing the berth in the latest message
    # Then train description is displayed in the berth and colour reflects punctuality (not no timetable colour)

    # Given a TD update with the type <Step Type> has been received
    # And a prior TD update has been matched to the service in the last 20 mins
    # And the user is viewing the map that contains that berth
    # When the user opens the context menu for the train description
    # Then the matched version of the context menu is displayed

    # Examples:
     # | Step Type |
     # | Step |
    Given the following VSTP messages are sent from LINX
      | asXml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      | <VSTPCIFMsgV1 xmlns="http://xml.networkrail.co.uk/ns/2008/Train" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:eai="http://xml.networkrail.co.uk/ns/2008/EAI" classification="industry" timestamp="2020-02-24T00:47:08-00:00" owner="Network Rail"	originMsgId="2020-02-24T00:47:10-00:00@vstp.networkrail.co.uk">	<eai:Sender organisation="Network Rail" application="TSIA" component="TSIA" userID="#WAEDMRT" sessionID="X289735" /><schedule schedule_id="" transaction_type="Create"	schedule_start_date="20210118" schedule_end_date="20500101"	schedule_days_runs="1111111" applicable_timetable="N" CIF_bank_holiday_running="" CIF_train_uid="R12345" train_status="2" CIF_stp_indicator="O"><schedule_segment signalling_id="1A55" uic_code="" atoc_code="" CIF_train_category="H4" CIF_headcode="6Y01" CIF_course_indicator="" CIF_train_service_code="57610310" CIF_business_sector="" CIF_power_type="D" CIF_timing_load="1660"	CIF_speed="125" CIF_operating_characteristics="AB" CIF_train_class="B" CIF_sleepers="F" CIF_reservations="A" CIF_connection_indicator="" CIF_catering_code="FC" CIF_service_branding="" CIF_traction_class=""><schedule_location scheduled_arrival_time=" " scheduled_departure_time="001101" scheduled_pass_time=" " public_arrival_time=" " public_departure_time="001201"	CIF_platform="1" CIF_line="ML" CIF_path="OL" CIF_activity="TB"	CIF_engineering_allowance="1" CIF_pathing_allowance="2"	CIF_performance_allowance="3"><location><tiploc tiploc_id="PTALBOT" /></location></schedule_location><schedule_location scheduled_arrival_time="011301"	scheduled_departure_time="      " scheduled_pass_time="      "  public_arrival_time="011401" public_departure_time="  "  CIF_platform="1" CIF_line="" CIF_path="OL" CIF_activity="TF"  CIF_engineering_allowance="4" CIF_pathing_allowance="5" CIF_performance_allowance="6"><location><tiploc tiploc_id="BGLAN" /></location></schedule_location></schedule_segment></schedule></VSTPCIFMsgV1> |
    And the following berth step message is sent from LINX
      | fromBerth  | timestamp  | toBerth   | trainDescriber   | trainDescription  |
      | 0244       | 10:02:06   | 0246      | D3               | 1A55              |
    And the following berth step message is sent from LINX
      | fromBerth  | timestamp  | toBerth   | trainDescriber   | trainDescription  |
      | 0246       | 10:05:06   | 0249      | D3               | 1A55              |
    When I am viewing the map <map>
    And berth '0246' in train describer 'D3' contains '1A55'
    And the train headcode color for berth 'D30249' is green
    When I invoke the context menu on the map for train '1A55'
    And the map context menu contains 'Match' on line 3
    And I open timetable from the map context menu
    And I switch to the new tab
    Then The values for the header properties are as follows
      | schedType | lastSignal | lastReport | trainUid   | trustId | lastTJM    | headCode          |
      | LTP       |            |            | R12345     |         |            | 1A55              |
